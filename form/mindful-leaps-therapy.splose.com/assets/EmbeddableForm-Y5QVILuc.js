import{B as E,N as j,z as a,ac as w,J as S,b as o,au as I,L as P,av as v,y as T,aA as z}from"./index-FU15wMs0.js";import{a as R,b as C}from"./onlineFormAPI-GVxuigCA.js";import A from"./Error-Lzr8w-x3.js";import{l as L,s as V}from"./Recaptcha-m1eQQgMc.js";import{s as k}from"./patientForm-WY92NC9C.js";import{F as q,q as B,o as K}from"./AddressAutocomplete.module-B6NgFNL3.js";import"./BackgroundUploadContext-Vbv4aRed.js";import{P as M}from"./PatientOnlineForm-lx6zIbYk.js";import"./Signature-8rPG6Pm2.js";import"./AddressAutocomplete-ouue8ZCf.js";import"./customValidators-RMpSoAkX.js";import"./PhoneTypeSelect--VZAaO77.js";import"./CalculationFormQuestion-SI6T_zxG.js";import"./SaveOutlined-gviPK1Pr.js";E.extend(j);const N=()=>{const[e,p]=o.useState(),[r]=q.useForm(),[s,g]=o.useState(),[m,l]=o.useState(!1),{formId:u}=I(),{handleError:f}=B(),[h,d]=o.useState(!1),[b,n]=o.useState(!1),[y,c]=o.useState(!1);async function F(){n("final"),c(!1);try{await r.validateFields()}catch{K.error("Please complete all required fields"),n(!1);return}try{const t=await V("booking"),i=T.merge(e==null?void 0:e.content,r.getFieldsValue().sections);await R({uuid:u,form:i,patientTimezone:z(),recaptcha:t}),n(!1),c(!0),l(!1)}catch(t){f(t),n(!1),c(!1)}}async function x(){d(!0);try{const t=await C(u),i=k(t.form);p(i),g(t.orgInfo),d(!1),r.setFieldsValue({sections:i.content})}catch(t){f(t,{redirect:!0}),d(!1)}}return o.useEffect(()=>(L(),x(),()=>{window.onbeforeunload=null}),[]),o.useEffect(()=>{window.onbeforeunload=m?()=>!0:null},[m]),h?a.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:a.jsx(P,{})}):!e||!s?a.jsx(A,{}):a.jsxs(a.Fragment,{children:[a.jsx(M,{formInstance:r,submitting:b,mode:y?"submitted":"edit",data:{organisationName:s==null?void 0:s.name,logoKey:(e==null?void 0:e.headerImage)||(s==null?void 0:s.logoKey),brandingColor:e.brandingColor,content:e.content,submittedMessage:e.submittedMessage,country:s.country,isEmbeddableForm:!0,uuid:u},onSubmit:F,onValueChange:()=>l(!0)}),a.jsx(v,{when:m&&!b,message:"You have unsaved changes, are you sure you want to leave?"})]})},te=()=>a.jsx(w,{children:a.jsx(S,{path:"/public-form/:formId",component:N})});export{te as default};
